<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>node_modules/@lblod/ember-contenteditable-editor/addon/components/content-editable.js - editor-documentation</title>
    <meta name="description" content="LBLOD editor Documentation pages">
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/css/theme.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700' rel='stylesheet' type='text/css'>
    

</head>
<body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a href="../" class="navbar-brand">
              <img src="../assets/img/ember-logo.png" alt="enterprise logo">
            <span>editor-documentation</span>
          </a>
        </div>

        <div class="collapse navbar-collapse" id="nav">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="" class="fa fa-github github"></a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div id="main-wrapper" class="row">
        <div id="content-wrapper">
            <ol class="panel-group" id="sidebar" role="tablist" aria-multiselectable="true">
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-search-heading">
                        <h4 class="panel-title">
                      <a role="button" data-toggle="collapse" href="#sidebar-search" aria-expanded="true" aria-controls="collapseOne">
                        Search
                      </a>
                    </h4>
                    </div>
                    <div id="sidebar-search" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-search-heading">
                        <div class="panel-body">
                            <div id="api-tabview-filter">
                                <input type="search" id="api-filter" placeholder="Search...">
                            </div>
                        </div>
                    </div>
                </li>
                    <li class="panel panel-default">
                        <div class="panel-heading" role="tab" id="sidebar-version-heading">
                            <h4 class="panel-title">
                                <a role="button" href="/commits/2bbb5b15" target="_blank">
                                  Tag: 0.0.0.2bbb5b15
                                </a>
                            </h4>
                        </div>
                    </li>
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-modules-heading">
                        <h4 class="panel-title">
                    <a role="button" data-toggle="collapse" href="#sidebar-modules" aria-expanded="true" aria-controls="collapseOne">
                      Modules
                    </a>
                  </h4>
                    </div>
                    <div id="sidebar-modules" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-modules-heading">
                        <div class="panel-body">
                                <ol>
                                        <li>
                                            <a href="../modules/contenteditable-editor.html">contenteditable-editor</a>
                                        </li>
                                        <li>
                                            <a href="../modules/editor-core.html">editor-core</a>
                                        </li>
                                        <li>
                                            <a href="../modules/pernetApi.html">pernetApi</a>
                                        </li>
                                        <li>
                                            <a href="../modules/rdfa-editor.html">rdfa-editor</a>
                                        </li>
                                </ol>
                        </div>
                    </div>
                </li>
            
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-classes-heading">
                        <h4 class="panel-title">
                      <a role="button" data-toggle="collapse" href="#sidebar-classes" aria-expanded="true" aria-controls="collapseOne">
                        Classes
                      </a>
                    </h4>
                    </div>
                    <div id="sidebar-classes" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-classes-heading">
                        <div class="panel-body">
                            <ol>
                                    <li>
                                        <a href="../classes/ArrowHandler.html">ArrowHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/BackspaceHandler.html">BackspaceHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/BoldProperty.html">BoldProperty</a>
                                    </li>
                                    <li>
                                        <a href="../classes/CappedHistory.html">CappedHistory</a>
                                    </li>
                                    <li>
                                        <a href="../classes/ContentEditableComponent.html">ContentEditableComponent</a>
                                    </li>
                                    <li>
                                        <a href="../classes/DocumentStructureComponent.html">DocumentStructureComponent</a>
                                    </li>
                                    <li>
                                        <a href="../classes/DomHelpers.html">DomHelpers</a>
                                    </li>
                                    <li>
                                        <a href="../classes/EditorProperty.html">EditorProperty</a>
                                    </li>
                                    <li>
                                        <a href="../classes/EmphasisMarkdownHandler.html">EmphasisMarkdownHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/EnterHandler.html">EnterHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/EventProcessor.html">EventProcessor</a>
                                    </li>
                                    <li>
                                        <a href="../classes/HandlerResponse.html">HandlerResponse</a>
                                    </li>
                                    <li>
                                        <a href="../classes/HeaderMarkdownHandler.html">HeaderMarkdownHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/HintsRegistry.html">HintsRegistry</a>
                                    </li>
                                    <li>
                                        <a href="../classes/HintsRegistryDebugger.html">HintsRegistryDebugger</a>
                                    </li>
                                    <li>
                                        <a href="../classes/IgnoreModifiersHandler.html">IgnoreModifiersHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/ItalicProperty.html">ItalicProperty</a>
                                    </li>
                                    <li>
                                        <a href="../classes/ListInsertionMarkdownHandler.html">ListInsertionMarkdownHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/NodeWalker.html">NodeWalker</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RawEditor.html">RawEditor</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaBackspaceHandler.html">RdfaBackspaceHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaBlock.html">RdfaBlock</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaContextDebugger.html">RdfaContextDebugger</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaContextScanner.html">RdfaContextScanner</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaEditorComponent.html">RdfaEditorComponent</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaEditorDebugger.html">RdfaEditorDebugger</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaEditorDispatcher.html">RdfaEditorDispatcher</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaEditorLoadMonitor.html">RdfaEditorLoadMonitor</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaEditorSuggestedHintsComponent.html">RdfaEditorSuggestedHintsComponent</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaEditorToolbarComponent.html">RdfaEditorToolbarComponent</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RichNode.html">RichNode</a>
                                    </li>
                                    <li>
                                        <a href="../classes/TextInputHandler.html">TextInputHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/UnderlineProperty.html">UnderlineProperty</a>
                                    </li>
                            </ol>
                        </div>
                    </div>
                </li>
            </ol>
            <div class="content-container">
                <div class="apidocs">
                    <div id="docs-main">
                        <div class="content">
<div class="page-header">
    <h1><i class="fa fa-file-code-o" aria-hidden="true"></i>  File</h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
import Component from &#x27;@ember/component&#x27;;
import { computed } from &#x27;@ember/object&#x27;;
import { alias, union } from &#x27;@ember/object/computed&#x27;;
import layout from &#x27;../templates/components/content-editable&#x27;;
import forgivingAction from &#x27;../utils/forgiving-action&#x27;;
import RawEditor from &#x27;../utils/raw-editor&#x27;;
import EnterHandler from &#x27;../utils/enter-handler&#x27;;
import IgnoreModifiersHandler from &#x27;../utils/ignore-modifiers-handler&#x27;;
import BackspaceHandler from &#x27;../utils/backspace-handler&#x27;;
import TextInputHandler from &#x27;../utils/text-input-handler&#x27;;
import HeaderMarkdownHandler from &#x27;../utils/header-markdown-handler&#x27;;
// import EmphasisMarkdownHandler from &#x27;../utils/emphasis-markdown-handler&#x27;;
// import ListInsertionMarkdownHandler from &#x27;../utils/list-insertion-markdown-handler&#x27;;
import ArrowHandler from &#x27;../utils/arrow-handler&#x27;;
import TabHandler from &#x27;../utils/tab-handler&#x27;;
import { normalizeEvent } from &#x27;ember-jquery-legacy&#x27;;
import { warn, runInDebug } from &#x27;@ember/debug&#x27;;
import { A } from &#x27;@ember/array&#x27;;
import { isEmpty } from &#x27;@ember/utils&#x27;;
import { next } from &#x27;@ember/runloop&#x27;;

/**
 * content-editable is the core of {{#crossLinkModule &quot;rdfa-editor&quot;}}rdfa-editor{{/crossLinkModule}}.
 * It handles input events, provides an api for interaction with the document and provides a internal document representation.
 *
 * rdfa-editor embeds the {{#crossLink &quot;ContentEditableCompoment&quot;}}{{/crossLink}} and interacts with the document through the {{#crossLink &quot;RawEditor&quot;}}{{/crossLink}} interface.
 *
 * input is handled by input handlers such as the {{#crossLink &quot;TextInputHandler&quot;}}{{/crossLink}} and {{crossLink &quot;EnterHandler&quot;}}{{/crossLink}}.

 * @module contenteditable-editor
 * @main contenteditable-editor
 */

/**
 * Content editable editor component
 * @module contenteditable-editor
 * @class ContentEditableComponent
 * @extends Component
 */
export default Component.extend({
  layout,
  attributeBindings: [&#x27;isEditable:contenteditable&#x27;],

  /**
   * latest cursor position in the contenteditable, it is aliased to the rawEditor.currentSelection
   *
   * @property currentSelection
   * @type Array
   *
   * @private
   */
  currentSelection: alias(&#x27;rawEditor.currentSelection&#x27;),

  /**
   * latest text content in the contenteditable, it is aliased to the rawEditor.currentTextContent
   *
   *
   * @property currentTextContent
   * @type String
   *
   * @private
   */
  currentTextContent: alias(&#x27;rawEditor.currentTextContent&#x27;),

  /**
   * element of the component, it is aliased to the rawEditor.rootNode
   *
   * @property element
   * @type DOMElement
   *
   * @private
   */
  rootNode: null,

  /**
   * string representation of editable
   *
   * @property isEditable
   * @type string
   * @private
   */
  isEditable: computed(&#x27;editable&#x27;, function() {
    return this.get(&#x27;editable&#x27;).toString();
  }),

  /**
   * richNode is the rich representation of the component element,
   * it is aliased to the rawEditor.richNode
   *
   * @property richNode
   * @type RichNode
   * @private
   */
  richNode: alias(&#x27;rawEditor.richNode&#x27;),

  /**
   *
   * @property rawEditor
   * @type RawEditor
   */
  rawEditor: null,

  /**
   * components present in the editor
   * @property components
   * @type {Object}
   * @public
   */
  components: alias(&#x27;rawEditor.components&#x27;),

  /**
   * ordered set of input handlers
   * @property eventHandlers
   * @type Array
   * @public
   */
  inputHandlers: union(&#x27;externalHandlers&#x27;, &#x27;defaultHandlers&#x27;),

  /**
   * default input handlers
   * @property defaultHandlers
   * @type Array
   * @private
   */
  defaultHandlers: null,

  /**
   * external input handlersg
   * @property externalHandlers
   * @type Array
   * @private
   */
  externalHandlers: null,
  /**
   * @constructor
   */
  init() {
    this._super(...arguments);
    const rawEditor = RawEditor.create({
      handleFullContentUpdate: this.get(&#x27;handleFullContentUpdate&#x27;),
      textInsert: this.get(&#x27;textInsert&#x27;),
      textRemove: this.get(&#x27;textRemove&#x27;),
      selectionUpdate: this.get(&#x27;selectionUpdate&#x27;),
      elementUpdate: this.get(&#x27;elementUpdate&#x27;)
    });
    this.set(&#x27;rawEditor&#x27;, rawEditor);

    const defaultInputHandlers = [ ArrowHandler.create({rawEditor}),
                                   HeaderMarkdownHandler.create({rawEditor}),
                                   // EmphasisMarkdownHandler.create({rawEditor}),
                                   // ListInsertionMarkdownHandler.create({rawEditor}),
                                   EnterHandler.create({rawEditor}),
                                   BackspaceHandler.create({rawEditor}),
                                   TextInputHandler.create({rawEditor}),
                                   TabHandler.create({rawEditor}),
                                   IgnoreModifiersHandler.create({rawEditor})];

    this.set(&#x27;currentTextContent&#x27;, &#x27;&#x27;);
    this.set(&#x27;currentSelection&#x27;, [0,0]);
    this.set(&#x27;defaultHandlers&#x27;, defaultInputHandlers);
    this.set(&#x27;capturedEvents&#x27;, A());
    if( ! this.externalHandlers ) {
      this.set(&#x27;externalHandlers&#x27;, []);
    }
  },

  didUpdateAttrs(){
    this.rawEditor.set(&#x27;textInsert&#x27;,this.textInsert);
    this.rawEditor.set(&#x27;textRemove&#x27;,this.textRemove);
    this.rawEditor.set(&#x27;handleFullContentUpdate&#x27;,this.handleFullContentUpdate);
    this.rawEditor.set(&#x27;selectionUpdate&#x27;,this.selectionUpdate);
    this.rawEditor.set(&#x27;elementUpdate&#x27;,this.elementUpdate);
		this.rawEditor.set(&#x27;handleFullContentUpdate&#x27;,this.handleFullContentUpdate);
  },

  /**
   * specify whether the editor should autofocus the contenteditable field
   *
   * @property focused
   * @type boolean
   * @default false
   *
   * @public
   */
  focused: false,

  /**
   * specify whether the editor should be contenteditable
   *
   * @property editable
   * @type boolean
   * @default true
   *
   * @public
   */
  editable: true,

  /**
   * specify whether yielded value should escape html syntax
   *
   * @property yieldHTML
   * @type boolean
   * @default true
   *
   * @public
   */
  yieldHTML: true,

  /**
   * didRender hook, makes sure the element is focused
   * and calls the rootNodeUpdated action
   *
   * @method didRender
   */
  didInsertElement(){
    this._super(...arguments);
    this.set(&#x27;rawEditor.rootNode&#x27;, this.get(&#x27;element&#x27;));
    let el = this.get(&#x27;element&#x27;);
    // TODO: mapping using customEvents currently doesn&#x27;t work, remove when it does
    el.onpaste = (event) =&gt; this.paste(event);
    if (this.get(&#x27;focused&#x27;))
      el.focus();
    this.set(&#x27;rawEditor.currentNode&#x27;, this.rawEditor.rootNode);
    forgivingAction(&#x27;rawEditorInit&#x27;, this)(this.get(&#x27;rawEditor&#x27;));
    next( () =&gt; {
      forgivingAction(&#x27;elementUpdate&#x27;, this)();
      this.get(&#x27;rawEditor&#x27;).generateDiffEvents.perform();
      this.extractAndInsertComponents();
      this.get(&#x27;rawEditor&#x27;).updateRichNode();
    });
  },

  /**
   * willDestroyElement, calls the rootNodeUpdated action
   *
   * @method willDestroyElement
   *
   */
  willDestroyElement() {
    this.set(&#x27;richNode&#x27;, null);
    this.set(&#x27;rawEditor.rootNode&#x27;, null);
    forgivingAction(&#x27;elementUpdate&#x27;, this)();
  },

  /**
   * keyDown events are handled for simple input we take over from
   * browser input.
   */
  keyDown(event) {
    event = normalizeEvent(event);
    if (this.isHandledInputEvent(event)) {
      if (this.isCtrlZ(event)) {
        event.preventDefault();
        this.get(&#x27;rawEditor&#x27;).undo();
      }
      else {
        let handlers = this.get(&#x27;inputHandlers&#x27;).filter(h =&gt; h.isHandlerFor(event));
        try {
          handlers.some( handler =&gt; {
            let response = handler.handleEvent(event);
            if (!response.get(&#x27;allowBrowserDefault&#x27;))
              event.preventDefault();
            if (!response.get(&#x27;allowPropagation&#x27;))
              return true;
            return false;
          });
        }
        catch(e) {
          warn(&#x60;handler failure&#x60;, {id: &#x27;contenteditable.keydown.handler&#x27;});
          warn(e, {id: &#x27;contenteditable.keydown.handler&#x27;});
        }
      }
      this.get(&#x27;rawEditor&#x27;).updateRichNode();
      this.get(&#x27;rawEditor&#x27;).generateDiffEvents.perform();
      this.capturedEvents.pushObject(event);
    }
    else {
      runInDebug( () =&gt; {
        console.warn(&#x27;unhandled keydown&#x27;, event); //eslint-disable-line no-console
      });
    }
  },

  /**
   * currently we disable paste
   */
  paste(event) {
    // TODO support clipboardData, we want to filter on type text/plain and use that
    // see https://www.w3.org/TR/clipboard-apis/#paste-action
    const paste = (event.clipboardData || window.clipboardData).getData(&#x27;text&#x27;); // use &#x27;text/html&#x27; later on for parseable content
    const [ start , end ] = this.rawEditor.currentSelection;
    if ( start === end ) {
      // it&#x27;s a regular cursor, not a selection
      this.rawEditor.insertText(paste, this.rawEditor.currentPosition);
      this.rawEditor.setCurrentPosition(start + paste.length);
    }
    else {
      alert(&#x27;plakken over selecties wordt niet ondersteund&#x27;);
    }
    event.preventDefault();
    return false;
  },
  /**
   * keyUp events are parsed for complex input, for uncaptured events we update
   * the internal state to be inline with reality
   */
  keyUp(event) {
    this.handleUncapturedEvent(event);
  },

  /**
   * compositionEnd events are parsed for complex input, for uncaptured events we update
   * the internal state to be inline with reality
   */
  compositionEnd(event) {
    this.handleUncapturedEvent(event);
  },

  mouseUp(event) {
    this.get(&#x27;rawEditor&#x27;).updateRichNode();
    this.get(&#x27;rawEditor&#x27;).updateSelectionAfterComplexInput(event);
    this.get(&#x27;rawEditor&#x27;).generateDiffEvents.perform();
  },

  handleUncapturedEvent(event) {
    event = normalizeEvent(event);
    if (isEmpty(this.capturedEvents) || this.capturedEvents[0].key !== event.key || this.capturedEvents[0].target !== event.target) {
      this.set(&#x27;capturedEvents&#x27;, A()); // TODO: added this because tracking of captured events is broken, fix it
      this.get(&#x27;rawEditor&#x27;).externalDomUpdate(&#x27;uncaptured input event&#x27;, () =&gt; {});
    }
    else
      this.capturedEvents.shiftObject();
  },

  /**
   * find defined components, and recreate them
   */
  extractAndInsertComponents() {
    for (let element of this.get(&#x27;element&#x27;).querySelectorAll(&#x27;[data-contenteditable-cw-id]&#x27;)) {
      let name = element.getAttribute(&#x27;data-contenteditable-cw-name&#x27;);
      let content = JSON.parse(element.getAttribute(&#x27;data-contenteditable-cw-content&#x27;));
      let id = element.getAttribute(&#x27;data-contenteditable-cw-id&#x27;);
      let parent = element.parentNode;
      parent.innerHTML = &#x27;&#x27;;
      this.rawEditor.insertComponent(parent, name, content, id);
    }
  },

  /**
   * specifies whether an input event is &quot;simple&quot; or not
   * simple events can be translated to a increment of the cursor position
   *
   * @method isSimpleTextInputEvent
   * @param {DOMEvent} event
   *
   * @return {Boolean}
   * @private
   */
  isHandledInputEvent(event) {
    event = normalizeEvent(event);
    return this.isCtrlZ(event) || this.get(&#x27;inputHandlers&#x27;).filter(h =&gt; h.isHandlerFor(event)).length &gt; 0;
  },

  isCtrlZ(event) {
    return event.ctrlKey &amp;&amp; event.key === &#x27;z&#x27;;
  },
  actions: {
    removeComponent(id) {
      this.rawEditor.removeComponent(id);
    }
  }
});

    </pre>
</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../assets/vendor/prettify/prettify-min.js"></script>
    <script>prettyPrint();</script>
    <script src="../assets/vendor/jquery/jquery.min.js"></script>
    <script src="../assets/vendor/jquery-ui/jquery-ui.min.js"></script>
    <script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
    <script src="../assets/vendor/github-slugger/slugger.js"></script>
    <script src="../assets/js/yuidoc-bootstrap.js"></script>
</body>
</html>
