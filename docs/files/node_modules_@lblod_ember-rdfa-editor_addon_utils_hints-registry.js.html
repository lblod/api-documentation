<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>node_modules/@lblod/ember-rdfa-editor/addon/utils/hints-registry.js - editor-documentation</title>
    <meta name="description" content="LBLOD editor Documentation pages">
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/css/theme.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700' rel='stylesheet' type='text/css'>
    

</head>
<body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a href="../" class="navbar-brand">
              <img src="../assets/img/ember-logo.png" alt="enterprise logo">
            <span>editor-documentation</span>
          </a>
        </div>

        <div class="collapse navbar-collapse" id="nav">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="" class="fa fa-github github"></a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div id="main-wrapper" class="row">
        <div id="content-wrapper">
            <ol class="panel-group" id="sidebar" role="tablist" aria-multiselectable="true">
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-search-heading">
                        <h4 class="panel-title">
                      <a role="button" data-toggle="collapse" href="#sidebar-search" aria-expanded="true" aria-controls="collapseOne">
                        Search
                      </a>
                    </h4>
                    </div>
                    <div id="sidebar-search" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-search-heading">
                        <div class="panel-body">
                            <div id="api-tabview-filter">
                                <input type="search" id="api-filter" placeholder="Search...">
                            </div>
                        </div>
                    </div>
                </li>
                    <li class="panel panel-default">
                        <div class="panel-heading" role="tab" id="sidebar-version-heading">
                            <h4 class="panel-title">
                                <a role="button" href="/commits/2bbb5b15" target="_blank">
                                  Tag: 0.0.0.2bbb5b15
                                </a>
                            </h4>
                        </div>
                    </li>
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-modules-heading">
                        <h4 class="panel-title">
                    <a role="button" data-toggle="collapse" href="#sidebar-modules" aria-expanded="true" aria-controls="collapseOne">
                      Modules
                    </a>
                  </h4>
                    </div>
                    <div id="sidebar-modules" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-modules-heading">
                        <div class="panel-body">
                                <ol>
                                        <li>
                                            <a href="../modules/contenteditable-editor.html">contenteditable-editor</a>
                                        </li>
                                        <li>
                                            <a href="../modules/editor-core.html">editor-core</a>
                                        </li>
                                        <li>
                                            <a href="../modules/pernetApi.html">pernetApi</a>
                                        </li>
                                        <li>
                                            <a href="../modules/rdfa-editor.html">rdfa-editor</a>
                                        </li>
                                </ol>
                        </div>
                    </div>
                </li>
            
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-classes-heading">
                        <h4 class="panel-title">
                      <a role="button" data-toggle="collapse" href="#sidebar-classes" aria-expanded="true" aria-controls="collapseOne">
                        Classes
                      </a>
                    </h4>
                    </div>
                    <div id="sidebar-classes" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-classes-heading">
                        <div class="panel-body">
                            <ol>
                                    <li>
                                        <a href="../classes/ArrowHandler.html">ArrowHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/BackspaceHandler.html">BackspaceHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/BoldProperty.html">BoldProperty</a>
                                    </li>
                                    <li>
                                        <a href="../classes/CappedHistory.html">CappedHistory</a>
                                    </li>
                                    <li>
                                        <a href="../classes/ContentEditableComponent.html">ContentEditableComponent</a>
                                    </li>
                                    <li>
                                        <a href="../classes/DocumentStructureComponent.html">DocumentStructureComponent</a>
                                    </li>
                                    <li>
                                        <a href="../classes/DomHelpers.html">DomHelpers</a>
                                    </li>
                                    <li>
                                        <a href="../classes/EditorProperty.html">EditorProperty</a>
                                    </li>
                                    <li>
                                        <a href="../classes/EmphasisMarkdownHandler.html">EmphasisMarkdownHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/EnterHandler.html">EnterHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/EventProcessor.html">EventProcessor</a>
                                    </li>
                                    <li>
                                        <a href="../classes/HandlerResponse.html">HandlerResponse</a>
                                    </li>
                                    <li>
                                        <a href="../classes/HeaderMarkdownHandler.html">HeaderMarkdownHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/HintsRegistry.html">HintsRegistry</a>
                                    </li>
                                    <li>
                                        <a href="../classes/HintsRegistryDebugger.html">HintsRegistryDebugger</a>
                                    </li>
                                    <li>
                                        <a href="../classes/IgnoreModifiersHandler.html">IgnoreModifiersHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/ItalicProperty.html">ItalicProperty</a>
                                    </li>
                                    <li>
                                        <a href="../classes/ListInsertionMarkdownHandler.html">ListInsertionMarkdownHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/NodeWalker.html">NodeWalker</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RawEditor.html">RawEditor</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaBackspaceHandler.html">RdfaBackspaceHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaBlock.html">RdfaBlock</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaContextDebugger.html">RdfaContextDebugger</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaContextScanner.html">RdfaContextScanner</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaEditorComponent.html">RdfaEditorComponent</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaEditorDebugger.html">RdfaEditorDebugger</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaEditorDispatcher.html">RdfaEditorDispatcher</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaEditorLoadMonitor.html">RdfaEditorLoadMonitor</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaEditorSuggestedHintsComponent.html">RdfaEditorSuggestedHintsComponent</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RdfaEditorToolbarComponent.html">RdfaEditorToolbarComponent</a>
                                    </li>
                                    <li>
                                        <a href="../classes/RichNode.html">RichNode</a>
                                    </li>
                                    <li>
                                        <a href="../classes/TextInputHandler.html">TextInputHandler</a>
                                    </li>
                                    <li>
                                        <a href="../classes/UnderlineProperty.html">UnderlineProperty</a>
                                    </li>
                            </ol>
                        </div>
                    </div>
                </li>
            </ol>
            <div class="content-container">
                <div class="apidocs">
                    <div id="docs-main">
                        <div class="content">
<div class="page-header">
    <h1><i class="fa fa-file-code-o" aria-hidden="true"></i>  File</h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
import { A } from &#x27;@ember/array&#x27;;
import EmberObject, { computed } from &#x27;@ember/object&#x27;;
import { next } from &#x27;@ember/runloop&#x27;;
import { task, timeout } from &#x27;ember-concurrency&#x27;;

/**
* Bookkeeping of the editor hints
*
* @module rdfa-editor
* @class HintsRegistry
* @constructor
* @extends EmberObject
*/
export default EmberObject.extend({
  /**
  * @property index
  * @type Array
  */
  index: null,

  /**
  * @property registry
  * @type Array
  */
  registry: null,

  /**
  * @property activeRegion
  * @type Array
  */
  activeRegion: null,

  /**
  * @property activeHints
  * @type Array
  */
  activeHints: computed(&#x27;activeRegion&#x27;, &#x27;registry&#x27;, &#x27;registry.[]&#x27;, function() {
    const region = this.get(&#x27;activeRegion&#x27;);
    return this.get(&#x27;registry&#x27;).filter((hint) =&gt; {
      return region[0] &gt;= hint.location[0] &amp;&amp; region[1] &lt;= hint.location[1];
    });
  }),

  /**
   * @property registryObservers
   * @type Array
   * @private
   */
  registryObservers: null,

  init() {
    this.set(&#x27;index&#x27;, A());
    this.set(&#x27;registry&#x27;, A());
    this.set(&#x27;activeRegion&#x27;, A());
    this.set(&#x27;registryObservers&#x27;, A());
    this.set(&#x27;newCardObservers&#x27;, A());
    this.set(&#x27;removedCardObservers&#x27;, A());
    this.set(&#x27;higlightsForFutureRemoval&#x27;, A());
    this.set(&#x27;higlightsForFutureInsert&#x27;, A());
  },

  /**
   *
   * adds a registry observer callback
   *
   * @method addRegistryObserver
   *
   * @param {Function} callback to be executed when the registry is updated. Will receive the complete registry as a parameter.
   *
   * @public
   */
  addRegistryObserver(observer) {
    this.get(&#x27;registryObservers&#x27;).push(observer);
  },

  addNewCardObserver(observer) {
    this.get(&#x27;newCardObservers&#x27;).push(observer);
  },

  addRemovedCardObserver(observer) {
    this.get(&#x27;removedCardObservers&#x27;).push(observer);
  },

  /**
   * Handles an insert text event from the editor.
   * Returns the associated registry index.
   *
   * @method insertText
   *
   * @param {number} start Start index in de string array
   * @param {string} content Content of the insertion
   *
   * @return {Object} Index object of the registry.
   *                 Consists of:
   *                 - idx: id of the index object
   *                 - operation:  &#x27;remove&#x27; || &#x27;insert&#x27;
   *                 - delta: delta length of insertion || removal
   *                 - startIdx: start index string array
   *                 - endIdx: end index string array
   * @public
   */
  insertText(startIdx, content) {
    let index = this.initIndexEntry(&#x27;insert&#x27;, startIdx, startIdx + content.length, content.length);
    this.updateRegistry(index);
    this.appendToIndex(index);
    return index;
  },

  /**
   * Handles removal text event from the editor.
   * Returns the associated registry index.
   *
   * @method removeText
   *
   * @param {number} start Start index of the removed string array
   * @param {number} end End index of the removed string array
   *
   * @return {Object} Index object of the registry.
   *                 Consists of:
   *                 - idx: id of the index object
   *                 - operation:  &#x27;remove&#x27; || &#x27;insert&#x27;
   *                 - delta: delta length of insertion || removal
   *                 - startIdx: start index string array
   *                 - endIdx: end index string array
   *
   * @public
   */
  removeText(startIdx, endIdx) {
    let delta = -1 * Math.abs(endIdx - startIdx);
    let index = this.initIndexEntry(&#x27;remove&#x27;, startIdx, endIdx, delta);
    this.updateRegistry(index);
    this.appendToIndex(index);
    return index;
  },

  /**
   * Returns hints exactly at a provided location.
   *
   * @method getHintsAtLocation
   *
   * @param {[number, number]} location [start, end] of the location
   * @param {Object} [hrIdx] Index of the registry else registry at current index is provided
   * @param {string} [who] Name of the plugin to filter on
   *
   * @return {Array} Array of hints
   *
   * @public
   */
  getHintsAtLocation(location, hrIdx, who) {
    let updatedLocation = (hrIdx ? this.updateLocationToCurrentIndex(hrIdx, location) : location);

    const atLocation = (location, other) =&gt; {
      return location.toString() === other.toString();
    };

    let condition = null;
    if (who) {
      condition = (entry) =&gt; { return atLocation(entry.location, updatedLocation) &amp;&amp; entry.who == who; };
    } else {
      condition = (entry) =&gt; { return atLocation(entry.location, updatedLocation); };
    }

    return this.get(&#x27;registry&#x27;).filter(condition);
  },

  /**
   * Returns hints in a provided region.
   *
   * @method getHintsInRegion
   *
   * @param {Array} region [start, end]
   * @param {Object} [hrIdx] Index of the registry else registry at current index is provided
   * @param {string} [who] Name of the plugin to filter on
   *
   * @return {Array} Array of hints
   *
   * @public
   */
  getHintsInRegion(region, hrIdx, who) {
    let updatedRegion = (hrIdx ? this.updateLocationToCurrentIndex(hrIdx, region) : region);

    const inRegion = (location, region) =&gt; {
      return region[0] &lt;= location[0] &amp;&amp; region[1] &gt;= location[1];
    };

    let condition = null;
    if (who) {
      condition = (entry) =&gt; { return inRegion(entry.location, updatedRegion) &amp;&amp; entry.who == who; };
    } else {
      condition = (entry) =&gt; { return inRegion(entry.location, updatedRegion); };
    }

    return this.get(&#x27;registry&#x27;).filter(condition);
  },

  /**
   * Removes hints at an exact location.
   *
   * @method removeHintsAtLocation
   *
   * @param {Array} location [start, end]
   * @param {Object} [hrIdx] Index of the registry else registry at current index is provided
   * @param {string} [who] Name of the plugin to filter on
   *
   * @public
   */
  removeHintsAtLocation(location, hrIdx, who) {
    let updatedLocation = (hrIdx ? this.updateLocationToCurrentIndex(hrIdx, location) : location);

    const notAtLocation = (location, other) =&gt; {
      return location.toString() != other.toString();
    };

    let condition = null;
    if (who) {
      condition = (entry) =&gt; { return (notAtLocation(entry.location, updatedLocation) &amp;&amp; entry.who == who) || entry.who !== who; };
    } else {
      condition = (entry) =&gt; { return notAtLocation(entry.location, updatedLocation); };
    }

    let updatedRegistry = A();
    A(this.get(&#x27;registry&#x27;).forEach(entry =&gt; {
      if(condition(entry)){
        updatedRegistry.push(entry);
      }
      else{
        this.sendRemovedCardToObservers(entry.location);
      }
    }));


    if(updatedRegistry.get(&#x27;length&#x27;) !== this.get(&#x27;registry&#x27;).get(&#x27;length&#x27;)){
      this.replaceRegistryAndNotify(updatedRegistry);
    }

  },

  /**
   * Removes hints in a region.
   *
   * @method removeHintsInRegion
   *
   * @param {Array} region [start, end]
   * @param {Object} [hrIdx] Index of the registry else registry at current index is provided
   * @param {string} [who] Name of the plugin to filter on
   *
   * @public
   */
  removeHintsInRegion(region, hrIdx, who) {
   let updatedRegion = (hrIdx ? this.updateLocationToCurrentIndex(hrIdx, region) : region);

    const notInRegion = (location, region) =&gt; {
      return region[0] &gt; location[0] || region[1] &lt; location[1];
    };

    let condition = null;
    if (who) {
      condition = (entry) =&gt; { return (notInRegion(entry.location, updatedRegion) &amp;&amp; entry.who == who) || entry.who !== who; };
    } else {
      condition = (entry) =&gt; { return notInRegion(entry.location, updatedRegion); };
    }

    let updatedRegistry = A();
    this.get(&#x27;registry&#x27;).forEach(entry =&gt; {
      if(condition(entry)){
        updatedRegistry.push(entry);
      }
      else{
        this.higlightsForFutureRemoval.push({location: entry.location, hrIdx});
      }
    });

    this.set(&#x27;registry&#x27;, updatedRegistry);

    next(() =&gt; { this.batchProcessHighlightsUpdates.perform(); });

  },

  /**
   * This function executes multiple hints updates as a batch.
   * WHY
   * ---
   * a. decrease the amount of dead DOMNodes when updating highlights
   * b. potential performance gain.
   *
   * WARNING
   * -------
   * Experimental, so probably will change
   */
  batchProcessHighlightsUpdates: task(function* (){
    yield timeout(50);

    // The hints registry might not be updated by the editor yet,
    // so wait for the editor to inform hintsregistry of the updates on the underlying DOM, so the hint registry
    // has a correct index to work on.
    // If busy, move this operation to the next runloop
    if(this.rawEditor.generateDiffEvents.isRunning){
      next(() =&gt; { this.batchProcessHighlightsUpdates.perform(); });
      return;
    }

    let updatedHlToRemove = this.higlightsForFutureRemoval.map( entry =&gt; {
      return this.updateLocationToCurrentIndex(entry.hrIdx, entry.location);
    });

    this.set(&#x27;higlightsForFutureRemoval&#x27;, A());

    let updatedHlToInsert = this.higlightsForFutureInsert.map( entry =&gt; {
      return this.updateLocationToCurrentIndex(entry.hrIdx, entry.location);
    });

    this.set(&#x27;higlightsForFutureInsert&#x27;, A());

    let hasSameLocation = (loc1, loc2) =&gt;  loc1[0] == loc2[0] &amp;&amp; loc1[1] == loc2[1];

    let realRemoves = updatedHlToRemove.filter(rH =&gt; !this.registry.find(c =&gt; hasSameLocation(c.location, rH)));

    //remove duplicates
    let realInserts = updatedHlToInsert.reduce((acc, card) =&gt; {
      if(!acc.find(accCardSoFar =&gt; hasSameLocation(accCardSoFar, card)))
        acc.push(card);
      return acc;
    }, []);

    //remove obsolete highlights
    realInserts = realInserts.filter(rI=&gt; this.registry.find(c =&gt; hasSameLocation(c.location, rI)));

    if(realInserts.length == 0 &amp;&amp; realRemoves.length == 0){
      return;
    }
    realRemoves.forEach(this.sendRemovedCardToObservers.bind(this));
    realInserts.forEach(this.sendNewCardToObservers.bind(this));

    this.replaceRegistryAndNotify(this.registry);

  }).restartable(),

  /**
   * Adds collection of hints.
   *
   * @method addHints
   *
   * @param {Object} hrIdx Index of the registry
   * @param {string} who Name of the plugin
   * @param {Array} Array Hints to add
   *
   * @public
   */
  addHints(hrIdx, who, cards) {
    cards.map(card =&gt; {
      card.who = who;
      this.updateCardToCurrentIndex(hrIdx, card);
      if( !card.options || !card.options.noHighlight)
        this.higlightsForFutureInsert.push({location: card.location, hrIdx});
    }, this);

    next(() =&gt; { this.batchProcessHighlightsUpdates.perform(); });
  },

  /**
   * Provided a location and hrId, give back the current location for the actual state of the registry.
   *
   * @method updateLocationToCurrentIndex
   *
   * @param {Object} hrIdx Index of the registry
   * @param {[number, number]} location [start, end]
   *
   * @return {[number, number]} mapped location [start, end]
   * @public
   */
  updateLocationToCurrentIndex(indexEntry, location) {
    let remainingIndexes = this.getRemainingIndexes(indexEntry);
    return remainingIndexes.length === 0 ? location : remainingIndexes.reduce(this.updateLocationWithIndex.bind(this), location);
  },

  /**
   * Gets next index id.
   *
   * @method nextIndexId
   *
   * @return {number} The next index id
   *
   * @private
   */
  nextIndexId() {
    if(this.get(&#x27;index&#x27;).length == 0) {
      return 0;
    }
    return this.currentIndex().idx + 1;
  },

  /**
   * Gets current index.
   *
   * @method currentIndex
   *
   * @return {Object} The current index
   *
   * @private
   */
  currentIndex() {
    return this.get(&#x27;index&#x27;).slice(-1)[0];
  },

  /**
   * Inits index entry object.
   *
   * @method initIndexEntry
   *
   * @return {Object} Index entry
   *
   * @private
   */
  initIndexEntry(operation, startIdx, endIdx, delta) {
    let idx = this.nextIndexId();
    return {idx: idx, operation, startIdx, endIdx, delta};
  },

  /**
   * Appends index entry to index.
   *
   * @method appendToIndex
   *
   * @private
   */
  appendToIndex(indexEntry) {
    this.get(&#x27;index&#x27;).pushObject(indexEntry);
  },

  /**
   * Updates collection of cards with collection of index entries.
   * TODO: clean up
   *
   * @method applyIndexesToCards
   *
   * @private
   */
  applyIndexesToCards(indexes, cards) {
    let updatedCards = [];
    let hasChanged = false;

    for(let card of cards) {
      let cardData = this.applyIndexesToCard(indexes, card);
      hasChanged = cardData.hasChanged;
      if(cardData.isValid) {
        updatedCards.push(cardData.card);
      }
    }
    return {hasChanged, cards: updatedCards};
  },

  /**
   * Updates card with collection of indexes
   * TODO: clean up
   *
   * @method applyIndexesToCard
   *
   * @param {Array} indexes
   * @param {Object} card
   *
   * @return {Object}
   *
   * @private
   */
  applyIndexesToCard(indexes, card) {
    let hasChanged = false;
    let isValid = true;

    for(let index of indexes) {
      if(!this.doesLocationChange(index, card.location)) {
          continue;
      }

      card.set(&#x27;location&#x27;, this.updateLocationWithIndex(card.location, index));
      hasChanged = true;

      if(!this.isLocationValid(card.location)) {
        isValid = false;
        break;
      }
    }
    return {hasChanged, isValid, card};
  },


  /**
   * Updates card registry with provided index entry.
   *
   * @method updateRegistry
   *
   * @param {Object} indexEntry
   *
   * @private
   */
  updateRegistry(indexEntry) {
    let updatedRegistry = this.applyIndexesToCards([indexEntry], this.get(&#x27;registry&#x27;));
    if(updatedRegistry.hasChanged) {
      this.replaceRegistryAndNotify(A(updatedRegistry.cards));
    }
  },

  /**
   * Checks whether a location is valid.
   *
   * @method isLocationValid
   *
   * @param {[number, number]} location
   *
   * @return {boolean} Whether the location is valid
   *
   * @private
   */
  isLocationValid(location) {
    if(location[1] - 1 &lt; location[0]) {  //TODO: do we allow &#x27;pure&#x27; insert?
      return false;
    }
    return true;
  },

  /**
   * Given an index entry, check whether it affects location.
   *
   * @method doesLocationChange
   *
   * @param {[number, number]} location
   * @param {Object} index
   *
   * @return {boolean} Whether the location is affected by the given index entry
   *
   * @private
   */
  doesLocationChange(index, location) {
    if(index.startIdx &lt;= location[1] - 1) {
      return true;
    }
    return false;
  },

  /**
   * Given an index entry, check wether the location moves as block to left or right.
   *
   * @method doesLocationShiftsAsBlock
   *
   * @param {[number, number]} location
   * @param {Object} index
   *
   * @return {boolean} Whether the location shifts as block
   *
   * @private
   */
  doesLocationShiftsAsBlock(index, location) {
    if((location[0] - location[1] - 1) === 0) {
      return false;
    }

    if(index.operation === &#x27;insert&#x27; &amp;&amp; (index.startIdx &lt;= location[0])) {
      return true;
    }

    if(index.operation === &#x27;remove&#x27; &amp;&amp; (index.endIdx - 1&lt; location[0])) {
      return true;
    }

    return false;
  },

  /**
   * Given an index entry, update the location.
   * Note: might give an invalid location back
   *
   * @method updateLocationWithIndex
   *
   * @param {[number, number]} location Location to update
   * @param {Object} index Index entry to update the location with
   *
   * @return {[number, number]} Updated location based on the index entry
   *
   * @private
   */
  updateLocationWithIndex(location, index) {
    //nothing happens: text inserted or removed after location
    if(!this.doesLocationChange(index, location)) {
      return location;
    }

    //shift location to right or left
    if(this.doesLocationShiftsAsBlock(index, location)) {
      return [location[0] + index.delta,  location[1] + index.delta];
    }

    //shrink or expand location (may lead to negative interval)
    if(location.startIdx === location[1] - 1 &amp;&amp; index.operation === &#x27;insert&#x27;) {
      return [location[0], location[1] + index.delta - 1];
    }
    return [location[0], location[1] + index.delta];
  },


  /**
   * Given an index entry and a card, pull the card through the remaining index entries
   * to update the registy correctly.
   *
   * @method updateCardToCurrentIndex
   *
   * @param {Object} idx
   * @param {Object} card
   *
   * @private
   */
  updateCardToCurrentIndex(idx, card) {
    let remainingIndexes = this.getRemainingIndexes(idx);

    if(remainingIndexes.length &gt; 0) {
      let cardData = this.applyIndexesToCard(remainingIndexes, card);
      if(!cardData.isValid) {
        return;
      }
      card = cardData.card;
    }

    this.get(&#x27;registry&#x27;).pushObject(card);
  },

  /**
   * Given an index entry, give back the remaining index entries which lead to the head of the index.
   *
   * @method getRemainingIndexes
   *
   * @param {Object} indexEntry
   *
   * @private
   */
  getRemainingIndexes(indexEntry) {
    return this.get(&#x27;index&#x27;).slice(indexEntry.idx + 1);
  },


  /**
   * Update the registry and notify observers
   *
   * @method updateRegistryAndNotify
   *
   * @param {Ember.Array} registry
   *
   * @private
   */
  replaceRegistryAndNotify(registry) {
    this.set(&#x27;registry&#x27;, registry);
    this.sendRegistryToObservers(registry);
  },

  /**
   * send registry to registry observers
   *
   * @param {Array} registry
   *
   * @private
   */
  sendRegistryToObservers(registry) {
    this.get(&#x27;registryObservers&#x27;).forEach(obs =&gt; {
      obs(registry);
    });
  },

  sendNewCardToObservers(card){
    this.get(&#x27;newCardObservers&#x27;).forEach(obs =&gt; {
      obs(card);
    });
  },

  sendRemovedCardToObservers(card){
    this.get(&#x27;removedCardObservers&#x27;).forEach(obs =&gt; {
      obs(card);
    });
  }
});

    </pre>
</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../assets/vendor/prettify/prettify-min.js"></script>
    <script>prettyPrint();</script>
    <script src="../assets/vendor/jquery/jquery.min.js"></script>
    <script src="../assets/vendor/jquery-ui/jquery-ui.min.js"></script>
    <script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
    <script src="../assets/vendor/github-slugger/slugger.js"></script>
    <script src="../assets/js/yuidoc-bootstrap.js"></script>
</body>
</html>
